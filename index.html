<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Professional Finance Expense Tracker - Track your income and expenses offline">
    <meta name="theme-color" content="#29756F">
    <link rel="icon" type="image/png" href="image/favicon.png">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="image/icon.png">
    <title>Amar Taka</title>
    <script src="js/version.js"></script>
    <script>document.write('<link rel="stylesheet" href="css/styles.css?v=' + APP_VERSION + '">');</script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <img src="image/logo.png" alt="Amar Taka Logo" class="loading-logo">
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container">

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <!-- Modern Header Card -->
            <div class="home-header-wrapper">
                <div class="home-header-bg">
                    <div class="greeting-section">
                        <div>
                            <p class="greeting-time" id="greeting-time">Good afternoon,</p>
                            <h2 class="user-name" id="user-name">Your Name</h2>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button class="profile-switch-icon-btn" id="profile-switch-icon" style="display: none;"
                                title="Switch Profile">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <button class="header-menu-icon" id="notification-bell" title="Notifications">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="balance-card-white">
                    <div class="balance-header">
                        <span class="balance-label" data-lang="currentBalance">Current Balance</span>
                        <button class="privacy-toggle-btn" id="privacy-toggle" onclick="homeManager.togglePrivacy()">
                            <i class="fas fa-eye" id="privacy-icon"></i>
                        </button>
                    </div>
                    <h1 class="total-balance" id="total-balance">$0.00</h1>

                    <div class="income-expense-boxes">
                        <div class="income-box-teal">
                            <i class="fas fa-arrow-up"></i>
                            <div>
                                <p class="label" data-lang="monthlyIncome">Monthly Income</p>
                                <p class="value" id="header-income">$0</p>
                            </div>
                        </div>
                        <div class="expense-box-teal">
                            <i class="fas fa-arrow-down"></i>
                            <div>
                                <p class="label" data-lang="monthlyExpense">Monthly Expense</p>
                                <p class="value" id="header-expense">$0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-content">
                <!-- Transactions History Section -->
                <div class="transactions-history-section">
                    <div class="section-header">
                        <h3 class="section-title" data-lang="transactionsHistory">Transactions History</h3>
                        <a href="#transactions" class="see-all-link" data-lang="seeAll">See all</a>
                    </div>

                    <div class="transactions-list" id="home-transactions-list">
                        <!-- Transactions will be rendered here by JavaScript -->
                        <p class="no-transactions">No transactions yet</p>
                    </div>
                </div>

                <!-- Expense Overview Section -->
                <div class="transactions-history-section">
                    <div class="section-header">
                        <h3 class="section-title" data-lang="financeOverview">Finance Overview</h3>
                    </div>

                    <div class="card" id="expense-summary-card">
                        <div class="card-body" id="expense-summary-content">
                            <div class="expense-overview-grid">
                                <!-- Placeholder structure until JS loads -->
                                <div class="expense-stat-main">
                                    <span class="stat-label">This Month</span>
                                    <span class="stat-value">...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Savings Card -->
                <div class="card savings-card">
                    <div class="card-header">
                        <h3 data-lang="savings">Monthly Savings</h3>
                        <i class="fas fa-piggy-bank card-icon"></i>
                    </div>
                    <div class="card-body" id="savings-content">
                        <p class="amount" id="savings-amount">‡ß≥0</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="savings-progress"></div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Budget Card -->
                <div class="card budget-card">
                    <div class="card-header">
                        <h3 data-lang="monthlyBudget">Monthly Budget</h3>
                        <i class="fas fa-wallet card-icon"></i>
                    </div>
                    <div class="card-body">
                        <div id="budget-content">
                            <p class="budget-info" data-lang="noBudgetSet">No budget set</p>
                        </div>
                    </div>
                </div>


            </div>
        </div>

        <!-- Transactions Page -->
        <div id="transactions-page" class="page">
            <header class="page-header">
                <h1 class="page-title" data-lang="transactions">Transactions</h1>
            </header>

            <div class="page-content">
                <!-- Page Navigation Buttons -->
                <div class="page-nav-buttons" style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-primary" style="flex: 1;" disabled>
                        <i class="fas fa-wallet"></i>
                        <span data-lang="transactions">Transactions</span>
                    </button>
                    <button class="btn btn-secondary" id="goto-analysis-btn" style="flex: 1;">
                        <i class="fas fa-chart-line"></i>
                        <span data-lang="analysis">Analysis</span>
                    </button>
                </div>

                <!-- Search and Filter -->
                <div class="search-filter-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-input" placeholder="Search transactions..."
                            data-lang-placeholder="searchTransactions">
                    </div>
                    <div class="filter-row">
                        <div class="filter-buttons">
                            <button class="btn-filter active" data-filter="all" data-lang="all">All</button>
                            <button class="btn-filter" data-filter="income" data-lang="income">Income</button>
                            <button class="btn-filter" data-filter="expense" data-lang="expense">Expense</button>
                        </div>
                        <div class="sort-dropdown">
                            <select id="sort-select" class="sort-select setting-select">
                                <option value="newest" data-lang="newest">Newest</option>
                                <option value="oldest" data-lang="oldest">Oldest</option>
                                <option value="highest" data-lang="highest">Highest</option>
                                <option value="lowest" data-lang="lowest">Lowest</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Transaction List -->
                <div id="transaction-list" class="transaction-list">
                    <!-- Transactions will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Analysis Page -->
        <div id="analysis-page" class="page">
            <header class="page-header">
                <h1 class="page-title" data-lang="analysis">Analysis</h1>
            </header>

            <div class="page-content">
                <!-- Page Navigation Buttons -->
                <div class="page-nav-buttons" style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-secondary" id="goto-transactions-btn" style="flex: 1;">
                        <i class="fas fa-wallet"></i>
                        <span data-lang="transactions">Transactions</span>
                    </button>
                    <button class="btn btn-primary" style="flex: 1;" disabled>
                        <i class="fas fa-chart-line"></i>
                        <span data-lang="analysis">Analysis</span>
                    </button>
                </div>

                <!-- Period Selector -->
                <div class="period-selector">
                    <button class="btn-period" data-period="week" data-lang="weekly">Weekly</button>
                    <button class="btn-period active" data-period="month" data-lang="monthly">Monthly</button>
                    <button class="btn-period" data-period="year" data-lang="yearly">Yearly</button>
                </div>

                <!-- Financial Health Card (Simpler Summary) -->
                <div id="analysis-health-card" style="margin-bottom: 20px;"></div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Avg Daily Spend</span>
                        <span class="stat-value" id="avg-daily">‡ß≥0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Suggested Daily</span>
                        <span class="stat-value" id="suggested-daily">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label" data-lang="monthlyBudget">Monthly Budget</span>
                        <span class="stat-value" id="analysis-budget">‡ß≥0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label" data-lang="remaining">Remaining</span>
                        <span class="stat-value" id="budget-remaining">‡ß≥0</span>
                    </div>
                </div>

                <!-- Charts -->
                <div class="card chart-card">
                    <h3 class="card-title" data-lang="moneyDistribution">Where Your Money Went</h3>
                    <canvas id="category-chart"></canvas>
                </div>


            </div>
        </div>

        <!-- Goals Page -->
        <div id="goals-page" class="page">
            <header class="page-header">
                <h1 class="page-title" data-lang="savingsGoals">Savings Goals</h1>
            </header>

            <div class="page-content">
                <!-- Add Goal Button -->
                <button class="btn btn-primary" id="add-goal-btn"
                    style="width: 100%; margin-bottom: var(--spacing-md);">
                    <i class="fas fa-plus"></i>
                    <span data-lang="addNewGoal">Add New Goal</span>
                </button>

                <!-- Goals List -->
                <div id="goals-list" class="goals-list">
                    <!-- Goals will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page">
            <header class="page-header">
                <h1 class="page-title" data-lang="settings">Settings</h1>
            </header>

            <div class="page-content">
                <!-- Account Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Account</h3>
                    <div class="settings-group">
                        <div class="setting-item clickable demo-mode-hide" id="set-name-card">
                            <div class="setting-info">
                                <i class="fas fa-user setting-icon"></i>
                                <span class="setting-label">Change Name</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="setting-item clickable demo-mode-hide" id="set-budget-btn">
                            <div class="setting-info">
                                <i class="fas fa-wallet setting-icon"></i>
                                <span class="setting-label">Monthly Budget</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="setting-item demo-mode-hide">
                            <div class="setting-info">
                                <i class="fas fa-lock setting-icon"></i>
                                <span class="setting-label">App Lock</span>
                            </div>
                            <label class="toggle-switch" for="app-lock-toggle">
                                <input type="checkbox" id="app-lock-toggle" aria-label="Enable or disable app lock">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-vial setting-icon"></i>
                                <span class="setting-label">Demo Mode</span>
                            </div>
                            <label class="toggle-switch" for="demo-mode-toggle">
                                <input type="checkbox" id="demo-mode-toggle" aria-label="Enable or disable demo mode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item demo-mode-hide">
                            <div class="setting-info">
                                <i class="fas fa-briefcase setting-icon"></i>
                                <span class="setting-label">Secondary Profile</span>
                            </div>
                            <label class="toggle-switch" for="secondary-profile-toggle">
                                <input type="checkbox" id="secondary-profile-toggle"
                                    aria-label="Enable or disable secondary profile">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item clickable demo-mode-hide" id="switch-profile-btn"
                            style="display: none;">
                            <div class="setting-info">
                                <i class="fas fa-exchange-alt setting-icon"></i>
                                <span class="setting-label">Switch Profile</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="setting-value" id="current-profile-name">Personal</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preferences Section -->
                <div class="settings-section demo-mode-hide" id="preferences-section">
                    <h3 class="settings-section-title">Preferences</h3>
                    <div class="settings-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-language setting-icon"></i>
                                <span class="setting-label">Language</span>
                            </div>
                            <select id="language-select" class="setting-select">
                                <option value="en">English</option>
                                <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-palette setting-icon"></i>
                                <span class="setting-label">Theme</span>
                            </div>
                            <select id="theme-select" class="setting-select">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="system">System</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-dollar-sign setting-icon"></i>
                                <span class="setting-label">Currency</span>
                            </div>
                            <select id="currency-select" class="setting-select">
                                <option value="BDT">‡ß≥ BDT</option>
                                <option value="USD">$ USD</option>
                                <option value="EUR">‚Ç¨ EUR</option>
                                <option value="INR">‚Çπ INR</option>
                            </select>
                        </div>
                        <div class="setting-item clickable" id="manage-categories-btn">
                            <div class="setting-info">
                                <i class="fas fa-tags setting-icon"></i>
                                <span class="setting-label">Manage Categories</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                <!-- Data Management Section -->
                <div class="settings-section demo-mode-hide" id="data-management-section">
                    <h3 class="settings-section-title">Data Management</h3>
                    <div class="settings-group">
                        <div class="setting-item clickable" id="backup-btn">
                            <div class="setting-info">
                                <i class="fas fa-download setting-icon"></i>
                                <span class="setting-label">Backup</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="setting-item clickable" id="restore-btn">
                            <div class="setting-info">
                                <i class="fas fa-upload setting-icon"></i>
                                <span class="setting-label">Restore</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <input type="file" id="import-file" accept=".json" style="display: none;">
                        <div class="setting-item clickable" id="reset-data-btn">
                            <div class="setting-info">
                                <i class="fas fa-trash-alt setting-icon" style="color: var(--danger-color);"></i>
                                <span class="setting-label" style="color: var(--danger-color);">Reset All Data</span>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--danger-color);"></i>
                        </div>
                    </div>
                </div>

                <!-- About Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">About</h3>
                    <div class="settings-group">
                        <a href="https://github.com/SayfullahSayeb/Amar-Taka" class="setting-item clickable"
                            style="text-decoration: none; color: inherit;" target="_blank" rel="noopener noreferrer">
                            <div class="setting-info">
                                <i class="fas fa-users setting-icon"></i>
                                <span class="setting-label">About Project</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </a>
                        <div class="setting-item clickable" id="feedback-btn">
                            <div class="setting-info">
                                <i class="fas fa-comment-dots setting-icon"></i>
                                <span class="setting-label">Submit Feedback</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-info-circle setting-icon"></i>
                                <span class="setting-label">Version</span>
                            </div>
                            <span class="setting-value" id="app-version">1.0.0</span>
                        </div>
                    </div>
                </div>

                <p
                    style="text-align: center; color: var(--text-tertiary); font-size: 14px; margin-top: 20px; margin-bottom: 8px;">
                    Developed with <span style="color: #e25555;">‚ô°</span> by Sayeb
                </p>

            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span data-lang="home">Home</span>
            </button>
            <button class="nav-item" data-page="transactions">
                <i class="fas fa-wallet"></i>
                <span data-lang="transactions">Transactions</span>
            </button>

            <!-- Central Add Button -->
            <button class="nav-item nav-add-btn" id="nav-add-transaction-btn">
                <i class="fas fa-plus"></i>
            </button>

            <button class="nav-item" data-page="goals">
                <i class="fas fa-bullseye"></i>
                <span data-lang="savingsGoals">Savings</span>
            </button>
            <button class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span data-lang="settings">Settings</span>
            </button>
        </nav>
    </div>

    <!-- Transaction Modal -->
    <div id="transaction-modal" class="modal">
        <div class="modal-content reset-modal-content" style="max-width: 600px;">
            <button class="btn-close" id="close-transaction-modal" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title" id="modal-title" data-lang="addTransaction">Add Transaction</h2>
            <p class="reset-modal-text">Track your income and expenses to manage your finances better.</p>

            <form id="transaction-form" style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label data-lang="type" style="text-align: left;">Type</label>
                    <div class="type-toggle">
                        <button type="button" class="type-btn active" data-type="expense">
                            <i class="fas fa-minus-circle"></i>
                            <span data-lang="expense">Expense</span>
                        </button>
                        <button type="button" class="type-btn" data-type="income">
                            <i class="fas fa-plus-circle"></i>
                            <span data-lang="income">Income</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="amount" data-lang="amount" style="text-align: left;">Amount</label>
                    <input type="number" id="amount" required min="0" step="0.01" placeholder="0.00">
                </div>

                <!-- Category and Payment Method in same row -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="category" data-lang="category" style="text-align: left;">Category</label>
                        <select id="category" class="setting-select" required>
                            <!-- Categories will be populated dynamically -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="payment-method" data-lang="paymentMethod" style="text-align: left;">Payment
                            Method</label>
                        <select id="payment-method" class="setting-select">
                            <option value="cash" data-lang="cash">Cash</option>
                            <option value="card" data-lang="card">Card</option>
                            <option value="mobile" data-lang="mobileBanking">Mobile Banking</option>
                            <option value="bank" data-lang="bank">Bank</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="date" data-lang="date" style="text-align: left;">Date</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label for="note" data-lang="note" style="text-align: left;">Note (Optional)</label>
                    <textarea id="note" rows="3" placeholder="Add a note..."></textarea>
                </div>

                <input type="hidden" id="transaction-id">

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-transaction-btn"
                        data-lang="cancel">Cancel</button>
                    <button type="submit" class="btn-reset-delete enabled" data-lang="save"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">Save</button>
                    <button type="button" class="btn btn-danger" id="delete-transaction-btn" style="display: none;">
                        <i class="fas fa-trash"></i>
                        <span>Delete</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budget-modal" class="modal">
        <div class="modal-content reset-modal-content">
            <button class="btn-close" id="close-budget-modal" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title" data-lang="setMonthlyBudget">Set Monthly Budget</h2>
            <p class="reset-modal-text">Set your monthly spending limit to track your expenses effectively.</p>

            <form id="budget-form" style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label for="budget-amount" data-lang="budgetAmount">Budget Amount</label>
                    <input type="number" id="budget-amount" required min="0" step="0.01" placeholder="0.00">
                </div>

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-budget-btn"
                        data-lang="cancel">Cancel</button>
                    <button type="submit" class="btn-reset-delete enabled" data-lang="save"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Categories Modal -->
    <div id="categories-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang="manageCategories">Manage Categories</h2>
                <button class="btn-close" id="close-categories-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body categories-modal-body">
                <div id="categories-list">
                    <!-- Categories will be rendered here -->
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid var(--border-color); padding: var(--spacing-lg);">
                <button class="btn btn-primary" id="add-category-btn" style="width: 100%;">
                    <i class="fas fa-plus"></i>
                    <span data-lang="addCategory">Add Category</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Category Modal -->
    <div id="category-form-modal" class="modal">
        <div class="modal-content reset-modal-content">
            <button class="btn-close" id="close-category-form-modal"
                style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title" id="category-form-title">Add Category</h2>
            <p class="reset-modal-text">Create a custom category for your transactions.</p>

            <form id="category-form" style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label for="category-emoji" style="text-align: left;">Emoji</label>
                    <div class="emoji-picker-container">
                        <input type="text" id="category-emoji" required maxlength="2" placeholder="üè∑Ô∏è"
                            style="font-size: 32px; text-align: center; width: 80px;">
                        <div class="emoji-suggestions">
                            <button type="button" class="emoji-btn" data-emoji="üçî">üçî</button>
                            <button type="button" class="emoji-btn" data-emoji="üöó">üöó</button>
                            <button type="button" class="emoji-btn" data-emoji="üí°">üí°</button>
                            <button type="button" class="emoji-btn" data-emoji="üõçÔ∏è">üõçÔ∏è</button>
                            <button type="button" class="emoji-btn" data-emoji="üè•">üè•</button>
                            <button type="button" class="emoji-btn" data-emoji="üìö">üìö</button>
                            <button type="button" class="emoji-btn" data-emoji="üè†">üè†</button>
                            <button type="button" class="emoji-btn" data-emoji="üí∞">üí∞</button>
                            <button type="button" class="emoji-btn" data-emoji="üìà">üìà</button>
                            <button type="button" class="emoji-btn" data-emoji="üéÆ">üéÆ</button>
                            <button type="button" class="emoji-btn" data-emoji="‚òï">‚òï</button>
                            <button type="button" class="emoji-btn" data-emoji="üé¨">üé¨</button>
                            <button type="button" class="emoji-btn" data-emoji="‚úàÔ∏è">‚úàÔ∏è</button>
                            <button type="button" class="emoji-btn" data-emoji="üéÅ">üéÅ</button>
                            <button type="button" class="emoji-btn" data-emoji="üíä">üíä</button>
                            <button type="button" class="emoji-btn" data-emoji="üîß">üîß</button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="category-name" style="text-align: left;">Category Name</label>
                    <input type="text" id="category-name" required maxlength="30" placeholder="Enter category name">
                </div>

                <div class="form-group">
                    <label for="category-type" style="text-align: left;">Type</label>
                    <select id="category-type" class="setting-select" required>
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                        <option value="both">Both</option>
                    </select>
                </div>

                <input type="hidden" id="category-id">

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-category-btn">Cancel</button>
                    <button type="submit" class="btn-reset-delete enabled"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">Save</button>
                    <button type="button" class="btn btn-danger" id="delete-category-btn" style="display: none;">
                        <i class="fas fa-trash"></i>
                        <span>Delete</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    </form>
    </div>
    </div>

    <!-- Set Name Modal -->
    <div id="name-modal" class="modal">
        <div class="modal-content reset-modal-content">
            <button class="btn-close" id="close-name-modal" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title">Set Your Name</h2>
            <p class="reset-modal-text">Personalize your profile by setting your name.</p>

            <form id="name-form" style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label for="name-input">Your Name</label>
                    <input type="text" id="name-input" required maxlength="30" placeholder="Enter your name">
                </div>

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-name-btn">Cancel</button>
                    <button type="submit" class="btn-reset-delete enabled"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PIN Setup/Change Modal -->
    <div id="pin-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="pin-modal-title">Set PIN</h2>
                <button class="btn-close" id="close-pin-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="pin-setup-container">
                    <p class="pin-instruction" id="pin-instruction">Enter a 4-digit PIN</p>
                    <div class="pin-display">
                        <div class="pin-dot" id="pin-dot-1"></div>
                        <div class="pin-dot" id="pin-dot-2"></div>
                        <div class="pin-dot" id="pin-dot-3"></div>
                        <div class="pin-dot" id="pin-dot-4"></div>
                    </div>
                    <div class="pin-keypad">
                        <button class="pin-key" data-key="1">1</button>
                        <button class="pin-key" data-key="2">2</button>
                        <button class="pin-key" data-key="3">3</button>
                        <button class="pin-key" data-key="4">4</button>
                        <button class="pin-key" data-key="5">5</button>
                        <button class="pin-key" data-key="6">6</button>
                        <button class="pin-key" data-key="7">7</button>
                        <button class="pin-key" data-key="8">8</button>
                        <button class="pin-key" data-key="9">9</button>
                        <button class="pin-key pin-key-empty"></button>
                        <button class="pin-key" data-key="0">0</button>
                        <button class="pin-key pin-key-delete" data-key="delete">
                            <i class="fas fa-backspace"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lock Screen -->
    <div id="lock-screen" class="lock-screen hidden">
        <div class="lock-screen-content">
            <div class="lock-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2 class="lock-title">App Locked</h2>
            <p class="lock-subtitle">Enter your PIN to unlock</p>
            <div class="pin-display">
                <div class="pin-dot" id="lock-pin-dot-1"></div>
                <div class="pin-dot" id="lock-pin-dot-2"></div>
                <div class="pin-dot" id="lock-pin-dot-3"></div>
                <div class="pin-dot" id="lock-pin-dot-4"></div>
            </div>
            <p class="lock-error hidden" id="lock-error">Incorrect PIN. Try again.</p>
            <div class="pin-keypad">
                <button class="pin-key" data-key="1">1</button>
                <button class="pin-key" data-key="2">2</button>
                <button class="pin-key" data-key="3">3</button>
                <button class="pin-key" data-key="4">4</button>
                <button class="pin-key" data-key="5">5</button>
                <button class="pin-key" data-key="6">6</button>
                <button class="pin-key" data-key="7">7</button>
                <button class="pin-key" data-key="8">8</button>
                <button class="pin-key" data-key="9">9</button>
                <button class="pin-key pin-key-empty"></button>
                <button class="pin-key" data-key="0">0</button>
                <button class="pin-key pin-key-delete" data-key="delete">
                    <i class="fas fa-backspace"></i>
                </button>
            </div>
            <button class="forgot-pin-btn" id="forgot-pin-btn">
                <i class="fas fa-question-circle"></i>
                Forgot PIN?
            </button>
        </div>
    </div>

    <!-- Secondary Profile Setup Modal -->
    <div id="secondary-profile-setup-modal" class="modal">
        <div class="modal-content reset-modal-content" style="max-width: 450px;">
            <button class="btn-close" id="close-secondary-setup" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title">Setup Secondary Profile</h2>
            <p class="reset-modal-text">Create a separate profile for business or shared expenses.</p>

            <div style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label for="secondary-profile-name" style="text-align: left;">Profile Name</label>
                    <input type="text" id="secondary-profile-name" placeholder="Enter profile name" maxlength="30"
                        required>
                </div>

                <div class="form-group">
                    <label for="secondary-currency-select" style="text-align: left;">Currency</label>
                    <select id="secondary-currency-select" class="setting-select" style="width: 100%; max-width: 100%;">
                        <option value="BDT">‡ß≥ Bangladeshi Taka (BDT)</option>
                        <option value="USD">$ US Dollar (USD)</option>
                        <option value="EUR">‚Ç¨ Euro (EUR)</option>
                        <option value="INR">‚Çπ Indian Rupee (INR)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="secondary-monthly-budget" style="text-align: left;">Monthly Budget (Optional)</label>
                    <input type="number" id="secondary-monthly-budget" placeholder="Enter amount" min="0">
                </div>

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-secondary-setup">Cancel</button>
                    <button type="button" class="btn-reset-delete enabled" id="save-secondary-setup"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">Create Profile</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Disable Secondary Profile Modal -->
    <div id="disable-secondary-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Disable Secondary Profile</h2>
                <button class="btn-close" id="close-disable-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 14px;">
                    ‚ö†Ô∏è <strong>Warning:</strong> You are about to disable your secondary profile. Choose an option:
                </p>

                <div class="disable-option-card" id="disable-keep-data">
                    <div class="disable-option-icon">
                        <i class="fas fa-pause-circle"></i>
                    </div>
                    <div class="disable-option-content">
                        <h3>Keep Data & Deactivate</h3>
                        <p>Temporarily disable the profile. All data will be preserved and you can re-enable it anytime.
                        </p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>

                <div class="disable-option-card" id="disable-erase-data">
                    <div class="disable-option-icon" style="color: var(--danger-color);">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <div class="disable-option-content">
                        <h3 style="color: var(--danger-color);">Erase All Data & Disable</h3>
                        <p>Permanently delete all secondary profile data and disable it. This cannot be undone.</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            <div class="modal-footer"
                style="display: flex; gap: 12px; justify-content: flex-end; padding: var(--spacing-lg); border-top: 1px solid var(--border-color);">
                <button type="button" class="btn btn-secondary" id="cancel-disable-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goal-modal" class="modal">
        <div class="modal-content reset-modal-content">
            <button class="btn-close" id="close-goal-modal" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title" id="goal-modal-title" data-lang="createNewGoal">Create New Goal</h2>
            <p class="reset-modal-text" data-lang="goalDescription">Set a savings goal and track your progress towards
                achieving it.</p>

            <form id="goal-form" style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label for="goal-name" style="text-align: left;" data-lang="goalName">Goal Name</label>
                    <input type="text" id="goal-name" required maxlength="50"
                        data-lang-placeholder="goalNamePlaceholder" placeholder="e.g., MacBook Pro">
                </div>

                <div class="form-group">
                    <label for="goal-target" style="text-align: left;" data-lang="targetAmount">Target Amount</label>
                    <input type="number" id="goal-target" required min="1" step="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label for="goal-deadline" style="text-align: left;" data-lang="deadline">Deadline
                        (Optional)</label>
                    <input type="date" id="goal-deadline">
                </div>

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-goal-btn"
                        data-lang="cancel">Cancel</button>
                    <button type="submit" class="btn-reset-delete enabled"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);"
                        data-lang="save">Save</button>
                    <button type="button" class="btn btn-danger" id="delete-goal-btn" style="display: none;">
                        <i class="fas fa-trash"></i>
                        <span data-lang="delete">Delete</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Money Modal -->
    <div id="add-money-modal" class="modal">
        <div class="modal-content reset-modal-content" style="max-width: 400px;">
            <button class="btn-close" id="close-add-money-modal" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title" data-lang="addMoney">Add Money</h2>
            <p class="reset-modal-text">
                <span data-lang="addingMoneyTo">Adding money to:</span> <strong id="add-money-goal-name"></strong>
            </p>

            <form id="add-money-form" style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label for="add-money-amount" style="text-align: left;" data-lang="amount">Amount</label>
                    <input type="number" id="add-money-amount" required min="0.01" step="0.01" placeholder="0.00">
                </div>

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-add-money-btn"
                        data-lang="cancel">Cancel</button>
                    <button type="submit" class="btn-reset-delete enabled"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);" data-lang="addMoney">Add
                        Money</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Transaction History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang="recentAdditions">Recent Additions</h2>
                <button class="btn-close" id="close-history-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="history-transactions-list" class="history-transactions-list">
                    <!-- Transactions will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Transaction Modal -->\n <div id="edit-transaction-modal" class="modal">
        <div class="modal-content reset-modal-content" style="max-width: 400px;">
            <button class="btn-close" id="close-edit-transaction-modal"
                style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <h2 class="reset-modal-title" data-lang="editTransaction">Edit Transaction</h2>
            <p class="reset-modal-text" id="edit-transaction-date" style="margin-bottom: 0;"></p>

            <form id="edit-transaction-form" style="width: 100%; margin-top: 20px;">
                <div class="form-group">
                    <label for="edit-transaction-amount" style="text-align: left;" data-lang="amount">Amount</label>
                    <input type="number" id="edit-transaction-amount" step="0.01" min="0.01" required>
                </div>

                <div class="reset-modal-buttons" style="margin-top: 24px;">
                    <button type="button" class="btn-reset-cancel" id="cancel-edit-transaction-btn" data-lang="cancel">
                        Cancel
                    </button>
                    <button type="submit" class="btn-reset-delete enabled"
                        style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">
                        <i class="fas fa-save"></i>
                        <span data-lang="save">Save</span>
                    </button>
                    <button type="button" class="btn btn-danger" id="delete-transaction-btn">
                        <i class="fas fa-trash"></i>
                        Delete
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirm-title">Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirm-message"
                    style="color: var(--text-primary); font-size: var(--font-size-md); line-height: 1.6;"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="confirm-cancel">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-ok">Delete</button>
            </div>
        </div>
    </div>

    <!-- Backup Modal -->
    <div id="backup-modal" class="modal">
        <div class="modal-content reset-modal-content">
            <button class="btn-close" id="close-backup-modal" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <div class="reset-modal-icon">
                <div class="trash-icon-wrapper" style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">
                    <i class="fas fa-download"></i>
                </div>
                <div class="sparkles">
                    <div class="sparkle" style="top: 10%; left: 10%; background: #438883;"></div>
                    <div class="sparkle" style="top: 20%; right: 15%; background: #438883;"></div>
                    <div class="sparkle" style="bottom: 15%; left: 20%; background: #438883;"></div>
                    <div class="sparkle" style="bottom: 10%; right: 10%; background: #438883;"></div>
                </div>
            </div>

            <h2 class="reset-modal-title">Download Backup</h2>
            <p class="reset-modal-text">
                Export all your data including transactions, goals, categories, and settings as a JSON backup file.
            </p>
            <p class="reset-modal-text" style="font-size: 13px; color: var(--text-tertiary);">
                <i class="fas fa-info-circle"></i> Keep this file safe to restore your data later
            </p>

            <div class="reset-modal-buttons">
                <button class="btn-reset-cancel" id="cancel-backup-btn">Cancel</button>
                <button class="btn-reset-delete enabled" id="confirm-backup-btn"
                    style="background: linear-gradient(135deg, #438883 0%, #5ba89f 100%);">
                    <i class="fas fa-download"></i>
                    <span>Download</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Restore Modal -->
    <div id="restore-modal" class="modal">
        <div class="modal-content reset-modal-content">
            <button class="btn-close" id="close-restore-modal" style="position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>

            <div class="reset-modal-icon">
                <div class="trash-icon-wrapper" style="background: linear-gradient(135deg, #34c759 0%, #4cd964 100%);">
                    <i class="fas fa-upload"></i>
                </div>
                <div class="sparkles">
                    <div class="sparkle" style="top: 10%; left: 10%; background: #34c759;"></div>
                    <div class="sparkle" style="top: 20%; right: 15%; background: #34c759;"></div>
                    <div class="sparkle" style="bottom: 15%; left: 20%; background: #34c759;"></div>
                    <div class="sparkle" style="bottom: 10%; right: 10%; background: #34c759;"></div>
                </div>
            </div>

            <h2 class="reset-modal-title">Restore from Backup</h2>
            <p class="reset-modal-text">
                Upload a backup file to restore your data. This will replace all current data with the backup.
            </p>
            <p class="reset-modal-text" style="font-size: 13px; color: var(--danger-color);">
                <i class="fas fa-exclamation-triangle"></i> Warning: This will overwrite your current data
            </p>

            <div class="reset-modal-buttons">
                <button class="btn-reset-cancel" id="cancel-restore-btn">Cancel</button>
                <button class="btn-reset-delete enabled" id="confirm-restore-btn"
                    style="background: linear-gradient(135deg, #34c759 0%, #4cd964 100%);">
                    <i class="fas fa-upload"></i>
                    <span>Choose File</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notifications-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-bell" style="margin-right: 8px;"></i>Notifications</h2>
                <button class="btn-close" id="close-notifications-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 0; max-height: 70vh; overflow-y: auto;">
                <div
                    style="padding: 16px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: var(--card-bg);">
                    <span style="font-size: 0.875rem; color: var(--text-secondary);" id="notifications-count">0
                        notifications</span>
                    <button class="btn btn-secondary" id="mark-all-read-btn"
                        style="padding: 6px 12px; font-size: 0.875rem;">
                        <i class="fas fa-check-double"></i>
                        <span>Mark all as read</span>
                    </button>
                </div>
                <div id="notifications-list">
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal">
        <div class="modal-content feedback-modal-content">
            <div class="feedback-modal-header">
                <button class="feedback-back-btn" id="feedback-back-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="feedback-header-title">Feedback</h2>
                <button class="feedback-close-btn" id="close-feedback-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="feedback-modal-body">
                <div id="feedback-form-container">
                    <h3 class="feedback-title">Share your feedback</h3>

                    <div class="feedback-section">
                        <label class="feedback-label">Rate your experience <span
                                style="color: var(--text-tertiary); font-size: 0.875em;">(Optional)</span></label>
                        <div class="emoji-rating-container">
                            <div class="emoji-rating-wrapper">
                                <button class="emoji-rating" data-rating="1" data-label="Terrible">üò°</button>
                            </div>
                            <div class="emoji-rating-wrapper">
                                <button class="emoji-rating" data-rating="2" data-label="Bad">üòû</button>
                            </div>
                            <div class="emoji-rating-wrapper">
                                <button class="emoji-rating" data-rating="3" data-label="Okay">üòê</button>
                            </div>
                            <div class="emoji-rating-wrapper">
                                <button class="emoji-rating" data-rating="4" data-label="Good">üòä</button>
                            </div>
                            <div class="emoji-rating-wrapper">
                                <button class="emoji-rating" data-rating="5" data-label="Awesome!">üòç</button>
                            </div>
                        </div>
                        <input type="hidden" id="feedback-rating">
                        <div class="emoji-rating-label" id="emoji-rating-label"></div>
                    </div>

                    <div class="feedback-section">
                        <label class="feedback-label">Which areas of the app do you find most useful or
                            important? <span
                                style="color: var(--text-tertiary); font-size: 0.875em;">(Optional)</span></label>
                        <div class="feedback-options-list">
                            <label class="feedback-option-item">
                                <span class="feedback-option-text">Budget management</span>
                                <input type="radio" name="feedback-useful-area" value="Budget management"
                                    class="feedback-radio feedback-circle-check">
                            </label>
                            <label class="feedback-option-item">
                                <span class="feedback-option-text">Monthly/weekly analysis</span>
                                <input type="radio" name="feedback-useful-area" value="Monthly/weekly analysis"
                                    class="feedback-radio feedback-circle-check">
                            </label>
                            <label class="feedback-option-item">
                                <span class="feedback-option-text">Savings / Goal feature</span>
                                <input type="radio" name="feedback-useful-area" value="Savings / Goal feature"
                                    class="feedback-radio feedback-circle-check">
                            </label>
                            <label class="feedback-option-item">
                                <span class="feedback-option-text">Reports & insights</span>
                                <input type="radio" name="feedback-useful-area" value="Reports & insights"
                                    class="feedback-radio feedback-circle-check">
                            </label>
                            <label class="feedback-option-item">
                                <span class="feedback-option-text">Other</span>
                                <input type="radio" name="feedback-useful-area" value="__other_option__"
                                    id="feedback-other-radio" class="feedback-radio feedback-circle-check">
                            </label>
                        </div>
                        <div id="feedback-other-input-container" class="feedback-other-input-container">
                            <input type="text" id="feedback-other-input" class="feedback-other-input"
                                placeholder="Please specify...">
                        </div>
                    </div>

                    <div class="feedback-section">
                        <label class="feedback-label">Tell us one thing you love and one thing we should
                            improve. <span
                                style="color: var(--text-tertiary); font-size: 0.875em;">(Optional)</span></label>
                        <textarea id="feedback-message" rows="3" placeholder="Describe your experience here"
                            class="feedback-textarea"></textarea>
                    </div>

                    <button id="submit-feedback-btn" class="feedback-submit-btn">
                        Submit Feedback
                    </button>
                </div>

                <div id="feedback-success" class="feedback-message feedback-success-message">
                    <i class="fas fa-check-circle"></i> Thank you! Feedback submitted.
                </div>

                <div id="feedback-error" class="feedback-message feedback-error-message">
                    <i class="fas fa-exclamation-circle"></i> Failed to submit feedback. Please try again.
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Onboarding Check -->
    <script>
        // Check if onboarding is completed before loading the app
        (async function checkOnboarding() {
            // First check localStorage for quick check
            const localStorageCheck = localStorage.getItem('onboardingCompleted');
            if (localStorageCheck === 'true') {
                // Onboarding completed, continue loading app
                return;
            }

            // If not in localStorage, check database
            const dbName = 'FinanceTrackerDB';
            const request = indexedDB.open(dbName, 1);

            request.onsuccess = async function (event) {
                const db = event.target.result;

                // Check if settings store exists
                if (!db.objectStoreNames.contains('settings')) {
                    // Database not initialized, show onboarding
                    window.location.href = 'pages/onboarding.html';
                    return;
                }

                const transaction = db.transaction(['settings'], 'readonly');
                const store = transaction.objectStore('settings');
                const getRequest = store.get('onboardingCompleted');

                getRequest.onsuccess = function () {
                    if (!getRequest.result || !getRequest.result.value) {
                        // Redirect to onboarding
                        window.location.href = 'pages/onboarding.html';
                    } else {
                        // Also set in localStorage for faster future checks
                        localStorage.setItem('onboardingCompleted', 'true');
                    }
                };

                getRequest.onerror = function () {
                    // If error or no data, show onboarding
                    window.location.href = 'pages/onboarding.html';
                };
            };

            request.onerror = function () {
                // If database doesn't exist, show onboarding
                window.location.href = 'pages/onboarding.html';
            };
        })();
    </script>

    <!-- Scripts with Cache Busting -->
    <script>
        const scripts = [
            'js/loading.js',
            'js/db.js',
            'js/lang.js',
            'js/utils.js',
            'js/categories.js',
            'js/categoryform.js',
            'js/home.js',
            'js/transactions.js',
            'js/analysis.js',
            'js/budget.js',
            'js/export.js',
            'js/settings.js',
            'js/applock.js',
            'js/demomode.js',
            'js/profiles.js',
            'js/goals.js',
            'js/notifications.js',
            'js/modal-scroll-lock.js',
            'js/navigation.js',
            'js/app.js'
        ];

        scripts.forEach(src => {
            document.write('<script src="' + src + '?v=' + APP_VERSION + '"><\/script>');
        });
    </script>


    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully');
                        
                        // Check for updates when user returns to the app
                        document.addEventListener('visibilitychange', () => {
                            if (!document.hidden && registration) {
                                registration.update();
                            }
                        });
                    })
                    .catch((error) => {
                    });
            });
        }
    </script>
</body>

</html>