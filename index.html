<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Professional Finance Expense Tracker - Track your income and expenses offline">
    <title>Amar Taka</title>

    <!-- Version Configuration (Load First) -->
    <script src="js/version.js"></script>

    <!-- Styles with Cache Busting -->
    <script>document.write('<link rel="stylesheet" href="css/styles.css?v=' + APP_VERSION + '">');</script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <!-- Main App Container -->
    <div id="app" class="app-container">

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <!-- Modern Header Card -->
            <div class="home-header-wrapper">
                <div class="home-header-bg">
                    <div class="greeting-section">
                        <div>
                            <p class="greeting-time" id="greeting-time">Good afternoon,</p>
                            <h2 class="user-name" id="user-name">Your Name</h2>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button class="profile-switch-icon-btn" id="profile-switch-icon" style="display: none;"
                                title="Switch Profile">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <a href="#settings" class="header-menu-icon">
                                <i class="fas fa-ellipsis-v"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="balance-card-white">
                    <div class="balance-header">
                        <span class="balance-label" data-lang="currentBalance">Current Balance</span>
                        <button class="privacy-toggle-btn" id="privacy-toggle" onclick="homeManager.togglePrivacy()">
                            <i class="fas fa-eye" id="privacy-icon"></i>
                        </button>
                    </div>
                    <h1 class="total-balance" id="total-balance">$0.00</h1>

                    <div class="income-expense-boxes">
                        <div class="income-box-teal">
                            <i class="fas fa-arrow-up"></i>
                            <div>
                                <p class="label" data-lang="monthlyIncome">Monthly Income</p>
                                <p class="value" id="header-income">$0</p>
                            </div>
                        </div>
                        <div class="expense-box-teal">
                            <i class="fas fa-arrow-down"></i>
                            <div>
                                <p class="label" data-lang="monthlyExpense">Monthly Expense</p>
                                <p class="value" id="header-expense">$0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-content">
                <!-- Transactions History Section -->
                <div class="transactions-history-section">
                    <div class="section-header">
                        <h3 class="section-title" data-lang="transactionsHistory">Transactions History</h3>
                        <a href="#transactions" class="see-all-link" data-lang="seeAll">See all</a>
                    </div>

                    <div class="transactions-list" id="home-transactions-list">
                        <!-- Transactions will be rendered here by JavaScript -->
                        <p class="no-transactions">No transactions yet</p>
                    </div>
                </div>

                <!-- Expense Overview Section -->
                <div class="transactions-history-section">
                    <div class="section-header">
                        <h3 class="section-title" data-lang="financeOverview">Finance Overview</h3>
                    </div>

                    <div class="card" id="expense-summary-card">
                        <div class="card-body" id="expense-summary-content">
                            <div class="expense-overview-grid">
                                <!-- Placeholder structure until JS loads -->
                                <div class="expense-stat-main">
                                    <span class="stat-label">This Month</span>
                                    <span class="stat-value">...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Savings Card -->
                <div class="card savings-card">
                    <div class="card-header">
                        <h3 data-lang="savings">Monthly Savings</h3>
                        <i class="fas fa-piggy-bank card-icon"></i>
                    </div>
                    <div class="card-body" id="savings-content">
                        <p class="amount" id="savings-amount">‡ß≥0</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="savings-progress"></div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Budget Card -->
                <div class="card budget-card">
                    <div class="card-header">
                        <h3 data-lang="monthlyBudget">Monthly Budget</h3>
                        <i class="fas fa-wallet card-icon"></i>
                    </div>
                    <div class="card-body">
                        <div id="budget-content">
                            <p class="budget-info" data-lang="noBudgetSet">No budget set</p>
                        </div>
                    </div>
                </div>

                <!-- Analysis Card -->
                <div class="card analysis-card clickable" id="analysis-card" style="cursor: pointer;">
                    <div class="card-header">
                        <h3>Financial Analysis</h3>
                        <i class="fas fa-chart-line card-icon"></i>
                    </div>
                    <div class="card-body">
                        <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">
                            View detailed insights about your spending patterns, income trends, and financial health.
                        </p>
                        <button class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-chart-pie"></i>
                            <span>View Analysis</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Transactions Page -->
        <div id="transactions-page" class="page">
            <header class="page-header">
                <h1 class="page-title" data-lang="transactions">Transactions</h1>
            </header>

            <div class="page-content">
                <!-- Page Navigation Buttons -->
                <div class="page-nav-buttons" style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-primary" style="flex: 1;" disabled>
                        <i class="fas fa-wallet"></i>
                        <span>Transactions</span>
                    </button>
                    <button class="btn btn-secondary" id="goto-analysis-btn" style="flex: 1;">
                        <i class="fas fa-chart-line"></i>
                        <span>Analysis</span>
                    </button>
                </div>

                <!-- Search and Filter -->
                <div class="search-filter-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-input" placeholder="Search transactions..."
                            data-lang-placeholder="searchTransactions">
                    </div>
                    <div class="filter-row">
                        <div class="filter-buttons">
                            <button class="btn-filter active" data-filter="all" data-lang="all">All</button>
                            <button class="btn-filter" data-filter="income" data-lang="income">Income</button>
                            <button class="btn-filter" data-filter="expense" data-lang="expense">Expense</button>
                        </div>
                        <div class="sort-dropdown">
                            <select id="sort-select" class="sort-select">
                                <option value="newest" data-lang="newest">Newest</option>
                                <option value="oldest" data-lang="oldest">Oldest</option>
                                <option value="highest" data-lang="highest">Highest</option>
                                <option value="lowest" data-lang="lowest">Lowest</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Transaction List -->
                <div id="transaction-list" class="transaction-list">
                    <!-- Transactions will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Analysis Page -->
        <div id="analysis-page" class="page">
            <header class="page-header">
                <h1 class="page-title" data-lang="analysis">Analysis</h1>
            </header>

            <div class="page-content">
                <!-- Page Navigation Buttons -->
                <div class="page-nav-buttons" style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-secondary" id="goto-transactions-btn" style="flex: 1;">
                        <i class="fas fa-wallet"></i>
                        <span>Transactions</span>
                    </button>
                    <button class="btn btn-primary" style="flex: 1;" disabled>
                        <i class="fas fa-chart-line"></i>
                        <span>Analysis</span>
                    </button>
                </div>

                <!-- Period Selector -->
                <div class="period-selector">
                    <button class="btn-period" data-period="week" data-lang="weekly">Weekly</button>
                    <button class="btn-period active" data-period="month" data-lang="monthly">Monthly</button>
                    <button class="btn-period" data-period="year" data-lang="yearly">Yearly</button>
                </div>

                <!-- Charts -->
                <div class="card chart-card">
                    <h3 class="card-title" data-lang="expenseTrend">Expense Trend</h3>
                    <canvas id="expense-chart"></canvas>
                </div>

                <div class="card chart-card">
                    <h3 class="card-title" data-lang="categoryBreakdown">Category Breakdown</h3>
                    <canvas id="category-chart"></canvas>
                </div>

                <!-- Insights -->
                <div class="card insights-card">
                    <h3 class="card-title" data-lang="insights">Insights</h3>
                    <div id="insights-list" class="insights-list">
                        <!-- Insights will be rendered here -->
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label" data-lang="avgDaily">Daily Average</span>
                        <span class="stat-value" id="avg-daily">‡ß≥0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label" data-lang="highestCategory">Top Category</span>
                        <span class="stat-value" id="highest-category">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label" data-lang="monthlyBudget">Monthly Budget</span>
                        <span class="stat-value" id="analysis-budget">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label" data-lang="remaining">Remaining</span>
                        <span class="stat-value" id="budget-remaining">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goals Page -->
        <div id="goals-page" class="page">
            <header class="page-header">
                <h1 class="page-title">Savings Goals</h1>
            </header>

            <div class="page-content">
                <!-- Add Goal Button -->
                <button class="btn btn-primary" id="add-goal-btn"
                    style="width: 100%; margin-bottom: var(--spacing-md);">
                    <i class="fas fa-plus"></i>
                    <span>Add New Goal</span>
                </button>

                <!-- Goals List -->
                <div id="goals-list" class="goals-list">
                    <!-- Goals will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page">
            <header class="page-header">
                <h1 class="page-title" data-lang="settings">Settings</h1>
            </header>

            <div class="page-content">
                <!-- Account Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Account</h3>
                    <div class="settings-group">
                        <div class="setting-item clickable" id="set-name-card">
                            <div class="setting-info">
                                <i class="fas fa-user setting-icon"></i>
                                <span class="setting-label">Change Name</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="setting-item clickable" id="set-budget-btn">
                            <div class="setting-info">
                                <i class="fas fa-wallet setting-icon"></i>
                                <span class="setting-label">Monthly Budget</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-lock setting-icon"></i>
                                <span class="setting-label">App Lock</span>
                            </div>
                            <label class="toggle-switch" for="app-lock-toggle">
                                <input type="checkbox" id="app-lock-toggle" aria-label="Enable or disable app lock">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-vial setting-icon"></i>
                                <span class="setting-label">Demo Mode</span>
                            </div>
                            <label class="toggle-switch" for="demo-mode-toggle">
                                <input type="checkbox" id="demo-mode-toggle" aria-label="Enable or disable demo mode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-briefcase setting-icon"></i>
                                <span class="setting-label">Secondary Profile</span>
                            </div>
                            <label class="toggle-switch" for="secondary-profile-toggle">
                                <input type="checkbox" id="secondary-profile-toggle"
                                    aria-label="Enable or disable secondary profile">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item clickable" id="switch-profile-btn" style="display: none;">
                            <div class="setting-info">
                                <i class="fas fa-exchange-alt setting-icon"></i>
                                <span class="setting-label">Switch Profile</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="setting-value" id="current-profile-name">Personal</span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preferences Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Preferences</h3>
                    <div class="settings-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-language setting-icon"></i>
                                <span class="setting-label">Language</span>
                            </div>
                            <select id="language-select" class="setting-select">
                                <option value="en">English</option>
                                <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-palette setting-icon"></i>
                                <span class="setting-label">Theme</span>
                            </div>
                            <select id="theme-select" class="setting-select">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="system">System</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-dollar-sign setting-icon"></i>
                                <span class="setting-label">Currency</span>
                            </div>
                            <select id="currency-select" class="setting-select">
                                <option value="BDT">‡ß≥ BDT</option>
                                <option value="USD">$ USD</option>
                                <option value="EUR">‚Ç¨ EUR</option>
                                <option value="INR">‚Çπ INR</option>
                            </select>
                        </div>
                        <div class="setting-item clickable" id="manage-categories-btn">
                            <div class="setting-info">
                                <i class="fas fa-tags setting-icon"></i>
                                <span class="setting-label">Manage Categories</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                <!-- Data Management Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Data Management</h3>
                    <div class="settings-group">
                        <div class="setting-item clickable" id="export-json-btn">
                            <div class="setting-info">
                                <i class="fas fa-download setting-icon"></i>
                                <span class="setting-label">Backup</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="setting-item clickable" id="import-btn">
                            <div class="setting-info">
                                <i class="fas fa-upload setting-icon"></i>
                                <span class="setting-label">Restore</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <input type="file" id="import-file" accept=".json" style="display: none;">
                        <div class="setting-item clickable" id="reset-data-btn">
                            <div class="setting-info">
                                <i class="fas fa-trash-alt setting-icon" style="color: var(--danger-color);"></i>
                                <span class="setting-label" style="color: var(--danger-color);">Reset All Data</span>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--danger-color);"></i>
                        </div>
                    </div>
                </div>

                <!-- About Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">About</h3>
                    <div class="settings-group">
                        <a href="https://github.com/SayfullahSayeb/Amar-Taka" class="setting-item clickable"
                            style="text-decoration: none; color: inherit;" target="_blank" rel="noopener noreferrer">
                            <div class="setting-info">
                                <i class="fas fa-users setting-icon"></i>
                                <span class="setting-label">About Project</span>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </a>
                        <div class="setting-item">
                            <div class="setting-info">
                                <i class="fas fa-info-circle setting-icon"></i>
                                <span class="setting-label">Version</span>
                            </div>
                            <span class="setting-value" id="app-version">1.0.0</span>
                        </div>
                    </div>
                </div>

                <p
                    style="text-align: center; color: var(--text-tertiary); font-size: 14px; margin-top: 20px; margin-bottom: 60px;">
                    Developed with <span style="color: #e25555;">‚ô°</span> by Sayeb
                </p>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span data-lang="home">Home</span>
            </button>
            <button class="nav-item" data-page="transactions">
                <i class="fas fa-wallet"></i>
                <span data-lang="transactions">Transactions</span>
            </button>

            <!-- Central Add Button -->
            <button class="nav-item nav-add-btn" id="nav-add-transaction-btn">
                <i class="fas fa-plus"></i>
            </button>

            <button class="nav-item" data-page="goals">
                <i class="fas fa-bullseye"></i>
                <span>Goals</span>
            </button>
            <button class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span data-lang="settings">Settings</span>
            </button>
        </nav>
    </div>

    <!-- Transaction Modal -->
    <div id="transaction-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" data-lang="addTransaction">Add Transaction</h2>
                <button class="btn-close" id="close-transaction-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="transaction-form" class="modal-body">
                <div class="form-group">
                    <label data-lang="type">Type</label>
                    <div class="type-toggle">
                        <button type="button" class="type-btn active" data-type="expense">
                            <i class="fas fa-minus-circle"></i>
                            <span data-lang="expense">Expense</span>
                        </button>
                        <button type="button" class="type-btn" data-type="income">
                            <i class="fas fa-plus-circle"></i>
                            <span data-lang="income">Income</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="amount" data-lang="amount">Amount</label>
                    <input type="number" id="amount" required min="0" step="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label for="category" data-lang="category">Category</label>
                    <select id="category" required>
                        <!-- Categories will be populated dynamically -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="payment-method" data-lang="paymentMethod">Payment Method</label>
                    <select id="payment-method">
                        <option value="cash" data-lang="cash">Cash</option>
                        <option value="card" data-lang="card">Card</option>
                        <option value="mobile" data-lang="mobileBanking">Mobile Banking</option>
                        <option value="bank" data-lang="bank">Bank</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date" data-lang="date">Date</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label for="note" data-lang="note">Note (Optional)</label>
                    <textarea id="note" rows="3" placeholder="Add a note..."></textarea>
                </div>

                <input type="hidden" id="transaction-id">

                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-transaction-btn"
                        style="display: none; margin-right: auto;">
                        <i class="fas fa-trash"></i>
                        <span>Delete</span>
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancel-transaction-btn"
                        data-lang="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-lang="save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budget-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang="setMonthlyBudget">Set Monthly Budget</h2>
                <button class="btn-close" id="close-budget-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="budget-form" class="modal-body">
                <div class="form-group">
                    <label for="budget-amount" data-lang="budgetAmount">Budget Amount</label>
                    <input type="number" id="budget-amount" required min="0" step="0.01" placeholder="0.00">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel-budget-btn"
                        data-lang="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-lang="save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Categories Modal -->
    <div id="categories-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang="manageCategories">Manage Categories</h2>
                <button class="btn-close" id="close-categories-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body categories-modal-body">
                <div id="categories-list">
                    <!-- Categories will be rendered here -->
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid var(--border-color); padding: var(--spacing-lg);">
                <button class="btn btn-primary" id="add-category-btn" style="width: 100%;">
                    <i class="fas fa-plus"></i>
                    <span data-lang="addCategory">Add Category</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Category Modal -->
    <div id="category-form-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="category-form-title">Add Category</h2>
                <button class="btn-close" id="close-category-form-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="category-form" class="modal-body">
                <div class="form-group">
                    <label for="category-emoji">Emoji</label>
                    <div class="emoji-picker-container">
                        <input type="text" id="category-emoji" required maxlength="2" placeholder="üè∑Ô∏è"
                            style="font-size: 32px; text-align: center; width: 80px;">
                        <div class="emoji-suggestions">
                            <button type="button" class="emoji-btn" data-emoji="üçî">üçî</button>
                            <button type="button" class="emoji-btn" data-emoji="üöó">üöó</button>
                            <button type="button" class="emoji-btn" data-emoji="üí°">üí°</button>
                            <button type="button" class="emoji-btn" data-emoji="üõçÔ∏è">üõçÔ∏è</button>
                            <button type="button" class="emoji-btn" data-emoji="üè•">üè•</button>
                            <button type="button" class="emoji-btn" data-emoji="üìö">üìö</button>
                            <button type="button" class="emoji-btn" data-emoji="üè†">üè†</button>
                            <button type="button" class="emoji-btn" data-emoji="üí∞">üí∞</button>
                            <button type="button" class="emoji-btn" data-emoji="üìà">üìà</button>
                            <button type="button" class="emoji-btn" data-emoji="üéÆ">üéÆ</button>
                            <button type="button" class="emoji-btn" data-emoji="‚òï">‚òï</button>
                            <button type="button" class="emoji-btn" data-emoji="üé¨">üé¨</button>
                            <button type="button" class="emoji-btn" data-emoji="‚úàÔ∏è">‚úàÔ∏è</button>
                            <button type="button" class="emoji-btn" data-emoji="üéÅ">üéÅ</button>
                            <button type="button" class="emoji-btn" data-emoji="üíä">üíä</button>
                            <button type="button" class="emoji-btn" data-emoji="üîß">üîß</button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="category-name">Category Name</label>
                    <input type="text" id="category-name" required maxlength="30" placeholder="Enter category name">
                </div>

                <div class="form-group">
                    <label for="category-type">Type</label>
                    <select id="category-type" required>
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                        <option value="both">Both</option>
                    </select>
                </div>

                <input type="hidden" id="category-id">

                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-category-btn"
                        style="display: none; margin-right: auto;">
                        <i class="fas fa-trash"></i>
                        <span>Delete</span>
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancel-category-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Set Name Modal -->
    <div id="name-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Your Name</h2>
                <button class="btn-close" id="close-name-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="name-form" class="modal-body">
                <div class="form-group">
                    <label for="name-input">Your Name</label>
                    <input type="text" id="name-input" required maxlength="30" placeholder="Enter your name">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel-name-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PIN Setup/Change Modal -->
    <div id="pin-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="pin-modal-title">Set PIN</h2>
                <button class="btn-close" id="close-pin-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="pin-setup-container">
                    <p class="pin-instruction" id="pin-instruction">Enter a 4-digit PIN</p>
                    <div class="pin-display">
                        <div class="pin-dot" id="pin-dot-1"></div>
                        <div class="pin-dot" id="pin-dot-2"></div>
                        <div class="pin-dot" id="pin-dot-3"></div>
                        <div class="pin-dot" id="pin-dot-4"></div>
                    </div>
                    <div class="pin-keypad">
                        <button class="pin-key" data-key="1">1</button>
                        <button class="pin-key" data-key="2">2</button>
                        <button class="pin-key" data-key="3">3</button>
                        <button class="pin-key" data-key="4">4</button>
                        <button class="pin-key" data-key="5">5</button>
                        <button class="pin-key" data-key="6">6</button>
                        <button class="pin-key" data-key="7">7</button>
                        <button class="pin-key" data-key="8">8</button>
                        <button class="pin-key" data-key="9">9</button>
                        <button class="pin-key pin-key-empty"></button>
                        <button class="pin-key" data-key="0">0</button>
                        <button class="pin-key pin-key-delete" data-key="delete">
                            <i class="fas fa-backspace"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lock Screen -->
    <div id="lock-screen" class="lock-screen hidden">
        <div class="lock-screen-content">
            <div class="lock-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2 class="lock-title">App Locked</h2>
            <p class="lock-subtitle">Enter your PIN to unlock</p>
            <div class="pin-display">
                <div class="pin-dot" id="lock-pin-dot-1"></div>
                <div class="pin-dot" id="lock-pin-dot-2"></div>
                <div class="pin-dot" id="lock-pin-dot-3"></div>
                <div class="pin-dot" id="lock-pin-dot-4"></div>
            </div>
            <p class="lock-error hidden" id="lock-error">Incorrect PIN. Try again.</p>
            <div class="pin-keypad">
                <button class="pin-key" data-key="1">1</button>
                <button class="pin-key" data-key="2">2</button>
                <button class="pin-key" data-key="3">3</button>
                <button class="pin-key" data-key="4">4</button>
                <button class="pin-key" data-key="5">5</button>
                <button class="pin-key" data-key="6">6</button>
                <button class="pin-key" data-key="7">7</button>
                <button class="pin-key" data-key="8">8</button>
                <button class="pin-key" data-key="9">9</button>
                <button class="pin-key pin-key-empty"></button>
                <button class="pin-key" data-key="0">0</button>
                <button class="pin-key pin-key-delete" data-key="delete">
                    <i class="fas fa-backspace"></i>
                </button>
            </div>
            <button class="forgot-pin-btn" id="forgot-pin-btn">
                <i class="fas fa-question-circle"></i>
                Forgot PIN?
            </button>
        </div>
    </div>

    <!-- Secondary Profile Setup Modal -->
    <div id="secondary-profile-setup-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Setup Secondary Profile</h2>
                <button class="btn-close" id="close-secondary-setup">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="secondary-profile-name">Profile Name</label>
                    <input type="text" id="secondary-profile-name" placeholder="Enter profile name" maxlength="30"
                        required>
                </div>

                <div class="form-group">
                    <label for="secondary-currency-select">Currency</label>
                    <select id="secondary-currency-select">
                        <option value="BDT">‡ß≥ Bangladeshi Taka (BDT)</option>
                        <option value="USD">$ US Dollar (USD)</option>
                        <option value="EUR">‚Ç¨ Euro (EUR)</option>
                        <option value="INR">‚Çπ Indian Rupee (INR)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="secondary-monthly-budget">Monthly Budget (Optional)</label>
                    <input type="number" id="secondary-monthly-budget" placeholder="Enter amount" min="0">
                </div>
            </div>
            <div class="modal-footer"
                style="display: flex; gap: 12px; justify-content: flex-end; padding: var(--spacing-lg); border-top: 1px solid var(--border-color);">
                <button type="button" class="btn btn-secondary" id="cancel-secondary-setup">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-secondary-setup">Create Profile</button>
            </div>
        </div>
    </div>

    <!-- Disable Secondary Profile Modal -->
    <div id="disable-secondary-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Disable Secondary Profile</h2>
                <button class="btn-close" id="close-disable-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 14px;">
                    ‚ö†Ô∏è <strong>Warning:</strong> You are about to disable your secondary profile. Choose an option:
                </p>

                <div class="disable-option-card" id="disable-keep-data">
                    <div class="disable-option-icon">
                        <i class="fas fa-pause-circle"></i>
                    </div>
                    <div class="disable-option-content">
                        <h3>Keep Data & Deactivate</h3>
                        <p>Temporarily disable the profile. All data will be preserved and you can re-enable it anytime.
                        </p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>

                <div class="disable-option-card" id="disable-erase-data">
                    <div class="disable-option-icon" style="color: var(--danger-color);">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <div class="disable-option-content">
                        <h3 style="color: var(--danger-color);">Erase All Data & Disable</h3>
                        <p>Permanently delete all secondary profile data and disable it. This cannot be undone.</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            <div class="modal-footer"
                style="display: flex; gap: 12px; justify-content: flex-end; padding: var(--spacing-lg); border-top: 1px solid var(--border-color);">
                <button type="button" class="btn btn-secondary" id="cancel-disable-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="goal-modal-title">Create New Goal</h2>
                <button class="btn-close" id="close-goal-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="goal-form" class="modal-body">
                <div class="form-group">
                    <label for="goal-name">Goal Name</label>
                    <input type="text" id="goal-name" required maxlength="50" placeholder="e.g., MacBook Pro">
                </div>

                <div class="form-group">
                    <label for="goal-target">Target Amount</label>
                    <input type="number" id="goal-target" required min="1" step="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label for="goal-deadline">Deadline (Optional)</label>
                    <input type="date" id="goal-deadline">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-goal-btn"
                        style="display: none; margin-right: auto;">
                        <i class="fas fa-trash"></i>
                        <span>Delete</span>
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancel-goal-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Money Modal -->
    <div id="add-money-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Add Money</h2>
                <button class="btn-close" id="close-add-money-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="add-money-form" class="modal-body">
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Adding money to: <strong id="add-money-goal-name"></strong>
                </p>

                <div class="form-group">
                    <label for="add-money-amount">Amount</label>
                    <input type="number" id="add-money-amount" required min="0.01" step="0.01" placeholder="0.00">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel-add-money-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Money</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Transaction History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Recent Additions</h2>
                <button class="btn-close" id="close-history-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="history-transactions-list" class="history-transactions-list">
                    <!-- Transactions will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div id="edit-transaction-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Edit Transaction</h2>
                <button class="btn-close" id="close-edit-transaction-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-transaction-form">
                <div class="modal-body">
                    <p id="edit-transaction-date"
                        style="color: var(--text-tertiary); margin-bottom: 16px; font-size: 14px;"></p>

                    <div class="form-group">
                        <label for="edit-transaction-amount">Amount</label>
                        <input type="number" id="edit-transaction-amount" step="0.01" min="0.01" required>
                    </div>
                </div>
                <div class="modal-footer" style="gap: var(--spacing-sm); padding: var(--spacing-lg);">
                    <button type="button" class="btn btn-danger" id="delete-transaction-btn">
                        <i class="fas fa-trash"></i>
                        Delete
                    </button>
                    <div style="flex: 1;"></div>
                    <button type="button" class="btn btn-secondary" id="cancel-edit-transaction-btn">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirm-title">Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirm-message"
                    style="color: var(--text-primary); font-size: var(--font-size-md); line-height: 1.6;"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="confirm-cancel">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-ok">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Onboarding Check -->
    <script>
        // Check if onboarding is completed before loading the app
        (async function checkOnboarding() {
            // First check localStorage for quick check
            const localStorageCheck = localStorage.getItem('onboardingCompleted');
            if (localStorageCheck === 'true') {
                // Onboarding completed, continue loading app
                return;
            }

            // If not in localStorage, check database
            const dbName = 'FinanceTrackerDB';
            const request = indexedDB.open(dbName, 1);

            request.onsuccess = async function (event) {
                const db = event.target.result;

                // Check if settings store exists
                if (!db.objectStoreNames.contains('settings')) {
                    // Database not initialized, show onboarding
                    window.location.href = 'onboarding.html';
                    return;
                }

                const transaction = db.transaction(['settings'], 'readonly');
                const store = transaction.objectStore('settings');
                const getRequest = store.get('onboardingCompleted');

                getRequest.onsuccess = function () {
                    if (!getRequest.result || !getRequest.result.value) {
                        // Redirect to onboarding
                        window.location.href = 'onboarding.html';
                    } else {
                        // Also set in localStorage for faster future checks
                        localStorage.setItem('onboardingCompleted', 'true');
                    }
                };

                getRequest.onerror = function () {
                    // If error or no data, show onboarding
                    window.location.href = 'onboarding.html';
                };
            };

            request.onerror = function () {
                // If database doesn't exist, show onboarding
                window.location.href = 'onboarding.html';
            };
        })();
    </script>

    <!-- Scripts with Cache Busting -->
    <script>
        // Dynamically load all JS files with version parameter
        const scripts = [
            'js/db.js',
            'js/lang.js',
            'js/utils.js',
            'js/categories.js',
            'js/categoryform.js',
            'js/home.js',
            'js/transactions.js',
            'js/analysis.js',
            'js/budget.js',
            'js/export.js',
            'js/settings.js',
            'js/applock.js',
            'js/demomode.js',
            'js/profiles.js',
            'js/goals.js',
            'js/app.js'
        ];

        scripts.forEach(src => {
            document.write('<script src="' + src + '?v=' + APP_VERSION + '"><\/script>');
        });
    </script>
</body>

</html>